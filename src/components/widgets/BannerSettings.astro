---
import { Icon } from "astro-icon/components";
---

<div class="dropdown dropdown-end">
  <div tabindex="0" role="button" class="btn btn-ghost btn-circle hover:bg-white/10 text-primary" title="Banner Settings">
    <Icon name="material-symbols:image-outline" class="w-5 h-5" />
  </div>
  <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow-2xl bg-base-200 rounded-box w-52">
    <li>
      <button data-set-banner="normal" class="flex gap-2 active">
        <Icon name="material-symbols:panorama-outline" class="w-5 h-5" />
        Banner Mode
      </button>
    </li>
    <li>
      <button data-set-banner="fullscreen" class="flex gap-2">
        <Icon name="material-symbols:fullscreen" class="w-5 h-5" />
        Fullscreen Mode
      </button>
    </li>
    <li>
      <button data-set-banner="background" class="flex gap-2">
        <Icon name="material-symbols:wallpaper" class="w-5 h-5" />
        Background Mode
      </button>
    </li>
    <li>
      <button data-set-banner="hidden" class="flex gap-2">
        <Icon name="material-symbols:hide-image-outline" class="w-5 h-5" />
        Hide Wallpaper
      </button>
    </li>
  </ul>
</div>

<script is:inline>
  document.addEventListener("astro:page-load", () => {
    const buttons = document.querySelectorAll("[data-set-banner]");
    
    // Update active state in menu
    const updateActiveButton = () => {
      const currentMode = document.documentElement.getAttribute("data-banner-mode") || localStorage.getItem("banner-mode") || "normal";
      
      buttons.forEach(btn => {
        if (btn.getAttribute("data-set-banner") === currentMode) {
          btn.classList.add("bg-primary/10", "text-primary", "font-bold", "active");
        } else {
          btn.classList.remove("bg-primary/10", "text-primary", "font-bold", "active");
        }
      });
    };

    // Initialize state
    updateActiveButton();

    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        const mode = btn.getAttribute("data-set-banner");
        document.documentElement.setAttribute("data-banner-mode", mode);
        localStorage.setItem("banner-mode", mode);
        // Direct update on click
        updateActiveButton();
      });
    });

    // Listen for external changes (syncs if changed elsewhere)
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-banner-mode') {
          updateActiveButton();
        }
      });
    });

    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-banner-mode']
    });
  });
</script>
